<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot
    </title>
  </head>
  <body>
    <!-- This is the container div where our React app will be rendered -->
    <div class="js-container"></div>
    

    <!-- Importing React library (core of React) -->
    <script src="https://unpkg.com/supersimpledev/react.js"></script> 
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script> 

    <!-- Importing ReactDOM library (used to render React elements into the DOM) -->
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <!-- Importing Babel (transpiler that converts JSX into JavaScript) -->
    <script src="https://unpkg.com/supersimpledev/babel.js"></script> 

    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>

    <!-- We write JSX code here. 
         type="text/babel" means Babel will convert it into plain JS so browsers understand -->
    <script type="text/babel"> 
      
      function ChatInput({ chatMessages, setChatMessages }){
        const [inputText, setInputText] = React.useState("");

        function saveInputText(event){
          setInputText(event.target.value);
        }

        async function sendMessage(){
          const newChatMessages = [
            ...chatMessages, // spread operator (...) is used to copy all existing chat messages into the new array.
            { message: inputText, sender: "user", id: crypto.randomUUID() }
          ];
          setChatMessages(newChatMessages);
          
          const response = await Chatbot.getResponseAsync(inputText);
          setChatMessages([
            ...newChatMessages, // spread operator (...) is used to copy all existing chat messages into the new array.
            { message: response, sender: "robot", id: crypto.randomUUID() }
          ]);

          setInputText(""); // Clear the input field after sending the message.
        }

        return(
          <>
            <input 
              placeholder="Send a message to chatbot" 
              size="30"
              onChange={saveInputText} 
              value={inputText}
            /> 
            <button onClick={sendMessage}>Send</button>
          </>
        );
      }

      function ChatMessage({message, sender}){
        return(
          <div>  
            {sender === 'robot' && (
              <img src="../robot.png" alt="" width="50"/>
            )}      
            {message}
            {sender === 'user' && (
              <img src="../user.png" alt="" width="50"/>
            )}  
          </div>
        );
        
      }

      function ChatMessages({chatMessages}){
        return(
          <>
            {chatMessages.map((chatMessage) =>{
              return(
                <ChatMessage 
                  message={chatMessage.message} 
                  sender={chatMessage.sender}
                  key={chatMessage.id}
                />
              );
            })}
          </>
        );
      }

      function App(){
        const [chatMessages, setChatMessages] = React.useState(
          [
          { message: "hello chatbot", sender: "user", id: "id1" },
          { message: "Hello! How can I help You?", sender: "robot", id: "id2" },
          { message: "Can you give me today's date?", sender: "user", id: "id3" },
          { message: `Today is ${dayjs().format('MMMM D, YYYY')}`, sender: "robot", id: "id4" }
        ]
        );

        return(
          <>
            <ChatInput 
              chatMessages={chatMessages} 
              setChatMessages={setChatMessages}
            />
            <ChatMessages 
              chatMessages={chatMessages} 
            />
          </>
        );
      }
      
      // Select the container div from HTML using querySelector
      const container = document.querySelector('.js-container');

      // Render the React element (div) into the container using ReactDOM
      ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>
