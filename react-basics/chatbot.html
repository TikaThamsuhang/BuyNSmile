<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot
    </title>
    <style>
      body{
        font-family: Arial, sans-serif;
        margin: 0;
      }
      .btn {
        background-color: rgb(25, 135, 84);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 15px;
      }

      .chat-input{
        padding: 12px 20px;
        border-radius: 10px;
        border: 1px solid grey;
        font-size: 15px;
        flex-grow: 1;
      }

      .chat-input-container{
        display: flex;
        margin-bottom: 60px;
      }

      .app-container{
        display: flex;
        max-width: 600px;
        margin: auto;
        height: 100vh;
        flex-direction: column;
      }

      .user-message, .robot-message{
        display: flex;
        align-items: start;

      }

      .user-message{
        justify-content: end;
      }

      .chat-message-text{
        background-color: rgb(238,238,238);
        padding: 15px 20px;
        border-radius: 10px;
        margin-left: 10px;
        margin-right: 10px;
        max-width: 300px;
        margin-bottom: 20px;
      }

      .chat-profile{
        width: 45px;
      }

      .chat-container{
        flex-grow: 1; 
        margin-top: 20px;
        overflow: scroll;
        scrollbar-width: none; 
      }

    </style>
  </head>
  <body>
    <!-- This is the container div where our React app will be rendered -->
    <div class="js-container"></div>
    

    <!-- Importing React library (core of React) -->
    <script src="https://unpkg.com/supersimpledev/react.js"></script> 
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script> 

    <!-- Importing ReactDOM library (used to render React elements into the DOM) -->
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <!-- Importing Babel (transpiler that converts JSX into JavaScript) -->
    <script src="https://unpkg.com/supersimpledev/babel.js"></script> 

    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>

    <!-- We write JSX code here. 
         type="text/babel" means Babel will convert it into plain JS so browsers understand -->
    <script type="text/babel"> 
      
      function ChatInput({ chatMessages, setChatMessages }){
        const [inputText, setInputText] = React.useState("");
        function saveInputText(event){
          setInputText(event.target.value);
        }

        function sendMessage(){
          const newChatMessages = [
            ...chatMessages, // spread operator (...) is used to copy all existing chat messages into the new array.
            { message: inputText, sender: "user", id: crypto.randomUUID() }
          ];
          setChatMessages(newChatMessages);

          const response = Chatbot.getResponse(inputText);
          setChatMessages([
            ...newChatMessages, // spread operator (...) is used to copy all existing chat messages into the new array.
            { message: response, sender: "robot", id: crypto.randomUUID() }
          ]);
          

          setInputText(""); // Clear the input field after sending the message.
        }

        return(
          <div className="chat-input-container">
            <input 
              placeholder="Send a message to chatbot" 
              size="30"
              onChange={saveInputText} 
              value={inputText}
              className="chat-input"
            /> 
            <button onClick={sendMessage} className="btn">Send</button>
          </div>
        );
      }

      function ChatMessage({message, sender}){
        // const message = props.message;
        // const sender = props.sender;
        // const { message,sender } =props; // Destructuring assignment to extract message and sender from props. Its takes message property out of this object and saves it in a variable named message.

        /*
        if(sender === 'robot'){
          return(
            <div>
              <img src="robot.png" alt="" width="50"/>
              {message}

            </div>
          );
        }
          */

        return(
          <div className={sender === 'user' ? 'user-message' : 'robot-message'}>  
            {sender === 'robot' && (
              <img src="robot.png" alt="" className='chat-profile'/>
            )}   
            <div className='chat-message-text'>   
              {message}
            </div>
            {sender === 'user' && (
              <img src="user.png" alt="" className='chat-profile'/>
            )}  
          </div>
        );
        
      }

      function ChatMessages({chatMessages}){
        const chatMessagesRef = React.useRef(null); // Create a ref to the chat messages container div

        React.useEffect(() => {
          // This code runs after every render (when chatMessages change)

          const containerElement = chatMessagesRef.current;
          if (containerElement){ // Check if the ref is attached to a DOM element
            // Scroll to the bottom of the chat container
            chatMessagesRef.current.scrollTop = chatMessagesRef.current.scrollHeight;
          } 
          
        }, [chatMessages]); // Dependency array: run this effect whenever chatMessages change

        return(
          <div className='chat-container' ref={chatMessagesRef}>
            {chatMessages.map((chatMessage) =>{
              return(
                <ChatMessage 
                  message={chatMessage.message} 
                  sender={chatMessage.sender}
                  key={chatMessage.id}
                />
              );
            })}
          </div>
        );
      }

      function App(){
        const [chatMessages, setChatMessages] = React.useState(
          [
          { message: "hello chatbot", sender: "user", id: "id1" },
          { message: "Hello! How can I help You?", sender: "robot", id: "id2" },
          { message: "Can you give me today's date?", sender: "user", id: "id3" },
          { message: `Today is ${dayjs().format('MMMM D, YYYY')}`, sender: "robot", id: "id4" }
        ]
        );

        // const [chatMessages, setChatMessages] = array;
        // const chatMessages = array[0]; // current state value (chat messages array)
        // const setChatMessages = array[1]; // function to update the state value (updater function)

        return(
          <div className="app-container">
            
            <ChatMessages 
              chatMessages={chatMessages} 
            />

            <ChatInput 
              chatMessages={chatMessages} 
              setChatMessages={setChatMessages}
            />
          </div>
        );
      }

      //Fragment <> </> is used to group multiple elements without adding extra nodes to the DOM.

      // A parent React element (div) containing a button and a paragraph.
      // Inside paragraph, {2 + 2} is evaluated as JavaScript expression, so it displays 4.
      // const app = (
      //   <>
      //     <ChatInput />
      //     <ChatMessage 
      //       message="hello chatbot" 
      //       sender="user"
      //     />
      //     <ChatMessage 
      //       message="Hello! How can I help You?" 
      //       sender="robot"
      //     />
      //     <ChatMessage 
      //       message="Can you give me today's date?" 
      //       sender="user"
      //     />
      //     <ChatMessage 
      //       message="Today is September 27" 
      //       sender="robot"
      //     />
      //   </>
      // );

      
      // Select the container div from HTML using querySelector
      const container = document.querySelector('.js-container');

      // Render the React element (div) into the container using ReactDOM
      ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>
